WhenGivenWhenTest
├── When initializing contract
│   ├── When USDC address is zero
│   │   └── it should revert
│   ├── When dispute handler is zero
│   │   └── it should revert
│   ├── When fee admin is zero
│   │   └── it should revert
│   ├── When dispute handler equals fee admin
│   │   └── it should revert
│   ├── When USDC equals dispute handler
│   │   └── it should revert
│   └── When USDC equals fee admin
│       └── it should revert
└── When the caller is authorized
    ├── Given creating a listing
    │   ├── When the price is zero
    │   │   └── it should revert
    │   ├── When the price exceeds maximum
    │   │   └── it should revert
    │   ├── When the title is blank
    │   │   └── it should revert
    │   ├── When the title exceeds length
    │   │   └── it should revert
    │   ├── When the fee calculation overflows
    │   │   └── it should revert
    │   └── When creation parameters are valid
    │       └── it should create listing with expiry time
    ├── Given initiating a buy
    │   ├── When the listing has timed out
    │   │   └── it should revert
    │   ├── When the listing status is invalid
    │   │   └── it should revert
    │   ├── When the buyer matches seller
    │   │   └── it should revert
    │   ├── When the payment fails
    │   │   └── it should revert
    │   └── When purchase parameters are valid
    │       └── it should lock funds in escrow
    ├── Given confirming a transaction
    │   ├── When confirmer is not buyer
    │   │   └── it should revert
    │   ├── When transaction state invalid
    │   │   └── it should revert
    │   ├── When escrow already released
    │   │   └── it should revert
    │   ├── When confirmation transfer fails
    │   │   └── it should revert
    │   └── When confirmation parameters valid
    │       └── it should finalize and transfer funds
    ├── Given requesting escrow release
    │   ├── When requester is not seller
    │   │   └── it should revert
    │   ├── When escrow period incomplete
    │   │   └── it should revert
    │   ├── When escrow state invalid
    │   │   └── it should revert
    │   ├── When release transfer fails
    │   │   └── it should revert
    │   └── When release parameters valid
    │       └── it should release funds to seller
    ├── Given handling a dispute
    │   ├── When handler lacks permission
    │   │   └── it should revert
    │   ├── When escrow funds gone
    │   │   └── it should revert
    │   ├── When buyer refund fails
    │   │   └── it should revert
    │   ├── When resolving for buyer
    │   │   └── it should return all funds to buyer
    │   └── When resolving for seller
    │       └── it should pay seller and collect fee
    ├── Given managing fees
    │   ├── When setting fee rate
    │   │   ├── When setter unauthorized
    │   │   │   └── it should revert
    │   │   └── When setter authorized
    │   │       └── it should update fee
    │   └── When withdrawing collected fees
    │       ├── When withdrawer unauthorized
    │       │   └── it should revert
    │       ├── When no fees collected
    │       │   └── it should revert
    │       └── When withdrawer authorized
    │           └── it should transfer collected fees
    ├── Given managing expiry
    │   ├── When checking timeout status
    │   │   ├── When past deadline
    │   │   │   └── it should return true
    │   │   └── When within deadline
    │   │       └── it should return false
    │   └── When attempting relist
    │       ├── When relister not owner
    │       │   └── it should revert
    │       ├── When listing still active
    │       │   └── it should revert
    │       └── When relist parameters valid
    │           └── it should update expiry and recalculate fee
    └── Given fetching data
        ├── When retrieving listing
        │   ├── When listing id invalid
        │   │   └── it should revert
        │   └── When listing id valid
        │       └── it should return listing with current status
        ├── When retrieving all listings
        │   └── it should return complete listing array
        └── When retrieving escrow details
            ├── When escrow id invalid
            │   └── it should revert
            └── When escrow id valid
                └── it should return escrow details